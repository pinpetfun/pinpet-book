### 流动性空间预留验证机制

本文档说明在插入保证金订单到链表时，如何依据上一个订单的价格区间，预留足够的“流动性空间”。核心常量为 `LIQUIDITY_RESERVATION`（百分比，定义于 `programs/spinpet/src/constants.rs`）。

### 记号说明
- **prev**: 前一个订单（已在链表中的订单）
- **cur**: 当前准备插入的订单
- `prev.lock_lp_start_price`、`prev.lock_lp_end_price`: 前一个订单锁定价格区间的起止价格
- `cur.lock_lp_start_price`: 当前订单锁定区间的起始价格
- `LIQUIDITY_RESERVATION`: 需预留的比例（百分比）

根据方向不同，`prev` 的价格区间定义不同：
- Down（做多链表）: 区间为 `prev_range = max(prev.start_price - prev.end_price, 0)`
- Up（做空链表）: 区间为 `prev_range = max(prev.end_price - prev.start_price, 0)`

并据此计算需预留的价格空间：

```
reservation = prev_range * LIQUIDITY_RESERVATION / 100
```

### Down（做多）方向验证
规则：需要满足

```
cur.lock_lp_start_price < prev.lock_lp_end_price - reservation
```

若 `prev.lock_lp_end_price - reservation` 发生下溢，则按 0 饱和处理（即阈值取 0）。

示例：
- 假设 `prev.start_price = 1_200`，`prev.end_price = 1_000`，则 `prev_range = 200`
- 设 `LIQUIDITY_RESERVATION = 25`（25%），则 `reservation = 200 * 25 / 100 = 50`
- 阈值 `threshold = 1_000 - 50 = 950`
- 需满足：`cur.start_price < 950` 才能通过验证

### Up（做空）方向验证
规则：需要满足

```
cur.lock_lp_start_price > prev.lock_lp_end_price + reservation
```

若 `prev.lock_lp_end_price + reservation` 发生上溢，则按 `u128::MAX` 饱和处理（即阈值取最大值）。

示例：
- 假设 `prev.start_price = 800`，`prev.end_price = 1_000`，则 `prev_range = 200`
- 设 `LIQUIDITY_RESERVATION = 25`（25%），则 `reservation = 200 * 25 / 100 = 50`
- 阈值 `threshold = 1_000 + 50 = 1_050`
- 需满足：`cur.start_price > 1_050` 才能通过验证

### 安全性与溢出处理
- 所有差值、乘法、加减均使用 `checked_*` 算术；
- Down 方向：`prev_end - reservation` 采用饱和下溢至 0；
- Up 方向：`prev_end + reservation` 采用饱和上溢至 `u128::MAX`；
- 若 `prev_range` 的基础差值计算不满足方向应有的大小关系，则视为 `0`。

### 相关实现
核心逻辑位于：
`programs/spinpet/src/instructions/context_validator.rs` 的 `validate_liquidity_reservation`。


