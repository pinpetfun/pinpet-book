# üí± Introduction aux fonctionnalit√©s de trading au comptant de PinPet

## üìä Vue d'ensemble des fonctionnalit√©s

Le trading au comptant est l'une des fonctionnalit√©s principales de la plateforme PinPet, permettant aux utilisateurs d'acheter et de vendre des jetons directement dans des pools de liquidit√© d√©centralis√©s. Contrairement au mod√®le traditionnel de carnet d'ordres, PinPet utilise un m√©canisme de teneur de march√© automatis√© (AMM) bas√© sur l'algorithme du produit constant (x √ó y = k) pour d√©terminer automatiquement les prix de trading.

**‚ú® Caract√©ristiques principales :**
- **‚ö° Ex√©cution instantan√©e** : Pas besoin d'attendre le matching entre acheteurs et vendeurs, les transactions sont compl√©t√©es imm√©diatement
- **üîç Prix transparents** : Les prix sont calcul√©s automatiquement par l'algorithme, de mani√®re ouverte et transparente
- **üåä Liquidit√© continue** : Tant qu'il y a suffisamment d'actifs dans le pool, le trading est possible √† tout moment
- **üõ°Ô∏è Protection contre le slippage** : Les utilisateurs peuvent d√©finir des limites de prix maximales/minimales pour se prot√©ger contre les fluctuations de prix anormales

---

## üõí Processus de transaction d'achat (Buy)

### üë§ √âtapes pour l'utilisateur

La transaction d'achat permet aux utilisateurs d'acheter des jetons de projet en utilisant des SOL (jeton natif de Solana).

```mermaid
flowchart TD
    Start([L'utilisateur initie une demande d'achat]) --> Input[Saisir la quantit√© d'achat et la limite de prix]
    Input --> Validate{Valider les param√®tres de transaction}
    Validate -->|Param√®tres invalides| Error1[Retourner un message d'erreur]
    Validate -->|Param√®tres valides| Calculate[Calculer les SOL n√©cessaires et les frais]
    Calculate --> Check{V√©rifier si la liquidation est d√©clench√©e}
    Check -->|Ordres expir√©s| Liquidate[Liquidation automatique des ordres expir√©s]
    Check -->|Pas de liquidation n√©cessaire| Transfer1
    Liquidate --> Transfer1[L'utilisateur transf√®re des SOL vers le pool]
    Transfer1 --> Transfer2[Le pool transf√®re des jetons √† l'utilisateur]
    Transfer2 --> Fee[R√©partir les frais de transaction]
    Fee --> Update[Mettre √† jour le prix et les r√©serves du pool]
    Update --> Success([Transaction termin√©e])
```

### üîë Explication des param√®tres cl√©s

| Nom du param√®tre | Description | Valeur exemple | Remarques |
|------------------|-------------|----------------|-----------|
| buy_token_amount | Quantit√© de jetons √† acheter | 1000000 (1 jeton) | Valeur minimale : 1000000 (1 jeton) |
| max_sol_amount | Montant maximal de SOL √† payer | 50000000 (0.05 SOL) | Utilis√© pour √©viter un slippage de prix excessif |
| lp_pairs | Instantan√© de l'√©tat du pool de liquidit√© | [{sol: 30, token: 1000000}] | Fourni automatiquement par le frontend |

### ‚öôÔ∏è Logique d'ex√©cution de la transaction

1. **Validation des param√®tres**
   - V√©rifier si la quantit√© d'achat atteint le volume de transaction minimal (1 jeton)
   - V√©rifier si l'√©tat du pool de liquidit√© est coh√©rent avec celui on-chain

2. **Calcul du prix**
   - Bas√© sur les r√©serves actuelles du pool, utiliser la formule du produit constant pour calculer les SOL n√©cessaires
   - Calculer le montant de paiement r√©el incluant les frais
   - V√©rifier si le prix d'ex√©cution r√©el d√©passe la valeur maximale d√©finie par l'utilisateur

3. **M√©canisme de liquidation automatique**
   - Si la transaction entra√Æne un franchissement du prix de liquidation de certains ordres √† effet de levier, le syst√®me liquide automatiquement ces ordres
   - Les frais g√©n√©r√©s par la liquidation sont r√©partis entre la plateforme et les partenaires

4. **Transfert de fonds**
   - Compte utilisateur ‚Üí Pool de liquidit√© : Transfert de SOL (frais inclus)
   - Pool de liquidit√© ‚Üí Compte utilisateur : Transfert de jetons

5. **R√©partition des frais**
   - R√©partition selon des proportions pr√©d√©finies aux partenaires et fournisseurs de technologie
   - Le taux de frais par d√©faut peut √™tre configur√© par l'administrateur

6. **Mise √† jour de l'√©tat**
   - Mettre √† jour le prix actuel du pool de liquidit√©
   - Recalculer les r√©serves de SOL et de jetons du pool
   - V√©rifier si une r√©duction de frais est d√©clench√©e

---

## üí∏ Processus de transaction de vente (Sell)

### üë§ √âtapes pour l'utilisateur

La transaction de vente permet aux utilisateurs de vendre leurs jetons d√©tenus en √©change de SOL.

```mermaid
flowchart TD
    Start([L'utilisateur initie une demande de vente]) --> Input[Saisir la quantit√© de vente et la limite de prix]
    Input --> Validate{Valider les param√®tres de transaction}
    Validate -->|Param√®tres invalides| Error1[Retourner un message d'erreur]
    Validate -->|Param√®tres valides| Calculate[Calculer les SOL obtenus et les frais]
    Calculate --> Check{V√©rifier si la liquidation est d√©clench√©e}
    Check -->|Ordres expir√©s| Liquidate[Liquidation automatique des ordres expir√©s]
    Check -->|Pas de liquidation n√©cessaire| Transfer1
    Liquidate --> Transfer1[L'utilisateur transf√®re des jetons vers le pool]
    Transfer1 --> Transfer2[Le pool transf√®re des SOL √† l'utilisateur]
    Transfer2 --> Fee[D√©duire et r√©partir les frais]
    Fee --> Update[Mettre √† jour le prix et les r√©serves du pool]
    Update --> Success([Transaction termin√©e])
```

### üîë Explication des param√®tres cl√©s

| Nom du param√®tre | Description | Valeur exemple | Remarques |
|------------------|-------------|----------------|-----------|
| sell_token_amount | Quantit√© de jetons √† vendre | 1000000 (1 jeton) | Valeur minimale : 1000000 (1 jeton) |
| min_sol_output | Montant minimal de SOL attendu | 20000000 (0.02 SOL) | Utilis√© pour √©viter un slippage de prix excessif |
| lp_pairs | Instantan√© de l'√©tat du pool de liquidit√© | [{sol: 30, token: 1000000}] | Fourni automatiquement par le frontend |

### ‚öôÔ∏è Logique d'ex√©cution de la transaction

1. **Validation des param√®tres**
   - V√©rifier si la quantit√© de vente atteint le volume de transaction minimal (1 jeton)
   - V√©rifier si le solde du compte de jetons de l'utilisateur est suffisant
   - Confirmer la validit√© de l'√©tat du pool de liquidit√©

2. **Calcul du prix**
   - Bas√© sur les r√©serves actuelles du pool, utiliser la formule du produit constant pour calculer les SOL obtenus
   - Calculer le montant r√©el cr√©dit√© apr√®s d√©duction des frais
   - V√©rifier si le prix d'ex√©cution r√©el est inf√©rieur √† la valeur minimale d√©finie par l'utilisateur

3. **M√©canisme de liquidation automatique**
   - Si la transaction entra√Æne un franchissement du prix de liquidation de certains ordres √† effet de levier, le syst√®me liquide automatiquement ces ordres
   - R√©partition des frais de liquidation et des r√©compenses de liquidation g√©n√©r√©s

4. **Transfert de fonds**
   - Compte utilisateur ‚Üí Pool de liquidit√© : Transfert de jetons
   - Pool de liquidit√© ‚Üí Compte utilisateur : Transfert de SOL (frais d√©duits)

5. **Traitement des frais**
   - D√©duire les frais des SOL dus
   - R√©partir proportionnellement aux partenaires et fournisseurs de technologie

6. **Mise √† jour de l'√©tat**
   - Mettre √† jour le prix actuel du pool de liquidit√© (baisse du prix)
   - Recalculer les r√©serves de SOL et de jetons du pool
   - V√©rifier si une r√©duction de frais est d√©clench√©e

---

## üí° Exemples de cas d'usage

### üìà Sc√©nario 1 : Transaction d'achat normale

**Contexte :**
- Prix actuel : 1 jeton = 0.03 SOL
- L'utilisateur veut acheter 10 jetons
- Taux de frais : 1%

**D√©roulement de l'op√©ration :**
1. L'utilisateur d√©finit la quantit√© d'achat : 10,000,000 (10 jetons)
2. L'utilisateur d√©finit le paiement maximal : 0.35 SOL (350,000,000)
3. Le syst√®me calcule le montant r√©ellement n√©cessaire : 0.303 SOL (frais inclus)
4. V√©rification du prix r√©ussie (ne d√©passe pas la limite maximale)
5. Ex√©cution de la transaction :
   - L'utilisateur paie 0.303 SOL
   - Re√ßoit 10 jetons
   - Frais de 0.003 SOL r√©partis √† la plateforme
6. Prix apr√®s transaction augment√© √† : 0.0303 SOL/jeton

---

### üìâ Sc√©nario 2 : Vente d√©clenchant une liquidation automatique

**Contexte :**
- Prix actuel : 1 jeton = 0.05 SOL
- Il existe un ordre long avec un prix de liquidation de 0.048 SOL
- L'utilisateur veut vendre 50 jetons

**D√©roulement de l'op√©ration :**
1. L'utilisateur d√©finit la quantit√© de vente : 50,000,000 (50 jetons)
2. L'utilisateur d√©finit le revenu minimal : 2.3 SOL
3. Le syst√®me d√©tecte que la vente fera chuter le prix en dessous de 0.048 SOL
4. Le syst√®me liquide automatiquement l'ordre long :
   - Calcul des profits/pertes de l'ordre
   - Pr√©l√®vement des frais de liquidation
   - Fermeture du compte d'ordre, remboursement du loyer
5. Poursuite de l'ex√©cution de la transaction de vente :
   - L'utilisateur transf√®re 50 jetons
   - Re√ßoit 2.4 SOL (apr√®s d√©duction des frais)
6. Prix apr√®s transaction diminu√© √† : 0.047 SOL/jeton

---

### üõ°Ô∏è Sc√©nario 3 : D√©clenchement de la protection contre le slippage

**Contexte :**
- Prix actuel : 1 jeton = 0.02 SOL
- L'utilisateur veut acheter 1000 jetons
- Le pool de liquidit√© est petit, une transaction importante causera un slippage significatif

**D√©roulement de l'op√©ration :**
1. L'utilisateur d√©finit la quantit√© d'achat : 1,000,000,000 (1000 jetons)
2. L'utilisateur d√©finit le paiement maximal : 21 SOL
3. Le syst√®me calcule le montant r√©ellement n√©cessaire : 22.5 SOL (frais inclus)
4. √âchec de la v√©rification du prix (d√©passe la limite maximale de l'utilisateur)
5. La transaction est rejet√©e, message d'erreur retourn√©
6. L'utilisateur peut choisir de :
   - Augmenter la limite de paiement maximal
   - R√©duire la quantit√© d'achat
   - Acheter par lots

---

## ‚ö†Ô∏è Pr√©cautions et limitations

### üö´ Limitations de transaction

| √âl√©ment de limitation | Exigence sp√©cifique | Explication |
|-----------------------|---------------------|-------------|
| Volume de transaction minimal | 1,000,000 (1 jeton) | √âviter que des transactions trop petites n'affectent l'efficacit√© du syst√®me |
| Limite de taux de frais | 10% | Prot√©ger les utilisateurs contre des frais excessifs |
| V√©rification de liquidit√© | Doit fournir un instantan√© de l'√©tat actuel du pool | Assurer la coh√©rence entre l'√©tat on-chain et off-chain |
| Protection contre le slippage de prix | max_sol_amount / min_sol_output obligatoires | √âviter les pertes caus√©es par des fluctuations de prix anormales |

### ‚ö†Ô∏è Avertissements sur les risques

1. **üìä Risque de fluctuation des prix**
   - Les transactions importantes causeront un slippage de prix significatif
   - Il est recommand√© d'effectuer les transactions importantes par lots pour r√©duire les co√ªts d'impact
   - D√©finir une tol√©rance de slippage raisonnable

2. **üí∞ Co√ªts de frais**
   - Chaque transaction g√©n√®re des frais
   - Les transactions fr√©quentes de petits montants accumuleront des co√ªts de frais √©lev√©s
   - Il est recommand√© de regrouper les transactions pour r√©duire les co√ªts

3. **üíß Risque de liquidit√©**
   - Lorsque la liquidit√© est insuffisante, les transactions importantes peuvent ne pas √™tre compl√©t√©es
   - Les r√©serves du pool affecteront le prix d'ex√©cution
   - Surveiller les r√©serves de SOL et de jetons du pool

4. **üîÑ Impact de la liquidation automatique**
   - Les transactions peuvent d√©clencher la liquidation automatique d'ordres √† effet de levier
   - La liquidation consommera une partie de la liquidit√©
   - Peut affecter le prix d'ex√©cution final


### üîß Exigences techniques

**üëõ Exigences c√¥t√© utilisateur :**
- Poss√©der un portefeuille Solana (comme Phantom, Solflare)
- Avoir suffisamment de SOL dans le compte pour les transactions et les frais de transaction
- Cr√©er un compte de jetons correspondant avant de trader (g√©n√©ralement g√©r√© automatiquement par le frontend)

**üíµ Composition des frais de transaction :**
- Frais r√©seau Solana : environ 0.000005 SOL (frais de signature de transaction)
- Frais de transaction : pr√©lev√©s en pourcentage du montant de la transaction (configur√© par l'administrateur)
- Loyer de compte : paiement unique si un nouveau compte doit √™tre cr√©√© (r√©cup√©rable)

### ‚ùì Questions fr√©quentes

**Q : Est-ce que je perds les frais si la transaction √©choue ?**
R : ‚úÖ Non. Si la transaction est rejet√©e en raison d'un √©chec de v√©rification des param√®tres, aucun frais ne sera d√©duit, seulement une petite quantit√© de frais r√©seau Solana (environ 0.000005 SOL) sera consomm√©e.

**Q : Comment obtenir le meilleur prix d'ex√©cution ?**
R : üí° Trader pendant les p√©riodes de liquidit√© suffisante, √©viter les volumes de transaction trop importants en une seule fois, surveiller le ratio SOL/Token du pool, choisir le bon moment pour trader.

**Q : La liquidation automatique affectera-t-elle ma transaction ?**
R : ‚ö†Ô∏è Peut-√™tre. Si votre transaction d√©clenche la liquidation d'un ordre √† effet de levier d'autrui, cela consommera une partie de la liquidit√©, ce qui peut entra√Æner une l√©g√®re diff√©rence entre le prix d'ex√©cution r√©el et celui attendu, mais toujours dans la plage de slippage que vous avez d√©finie.

**Q : Quelles sont les raisons courantes du rejet d'une transaction ?**
R : ‚ùå Les raisons courantes incluent :
- La quantit√© d'achat ou de vente est inf√©rieure au volume de transaction minimal (1 jeton)
- Le prix d'ex√©cution r√©el d√©passe la plage de protection contre le slippage que vous avez d√©finie
- Solde de compte insuffisant (SOL ou jetons)
- Instantan√© de l'√©tat du pool de liquidit√© expir√© (le frontend doit le r√©cup√©rer √† nouveau)

**Q : Comment les frais sont-ils calcul√©s et r√©partis ?**
R : üí∞ Les frais sont pr√©lev√©s en proportion du montant de la transaction (par d√©faut 1%, ajustable par l'administrateur), puis r√©partis selon des proportions pr√©d√©finies aux partenaires et fournisseurs de technologie. Dans certains cas, une r√©duction de frais peut √™tre appliqu√©e.

---

## üîó Fonctionnalit√©s connexes

- **üìä Trading √† effet de levier** : Effectuer des transactions long/short en utilisant un m√©canisme d'emprunt
- **üíß Gestion de liquidit√©** : Consulter et g√©rer l'√©tat des pools de liquidit√©
- **ü™ô Cr√©ation de jetons** : Cr√©er de nouvelles paires de trading de jetons
- **üìã Gestion des ordres** : Consulter et g√©rer les ordres de trading √† effet de levier

---

*üìù Note : Ce document est une description des fonctionnalit√©s du produit et n'inclut pas les d√©tails d'impl√©mentation technique. Pour des informations li√©es au d√©veloppement, veuillez consulter la documentation technique du projet.*
